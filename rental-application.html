<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rental Application - Newfound Living</title>
  <link rel="icon" type="image/png" sizes="32x32" href="/Logos/tinylogo1.png" />
  <link rel="stylesheet" href="styles.css" />

  <!-- Page-local styles: custom select (lease term) + narrow-scope tweaks -->
  <style>
    /* Keep native select available for form submission but hidden visually once JS enhances it */
    .select-hidden-keep {
      position: absolute !important;
      left: -9999px !important;
      top: auto !important;
      width: 1px !important;
      height: 1px !important;
      overflow: hidden !important;
      clip: rect(0 0 0 0);
      white-space: nowrap;
    }

    /* Custom select shell - made wider */
    .custom-select { position: relative; width: 100%; max-width: 640px; margin: 0.35rem auto 0; }
    .custom-select__control {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: .95rem 1rem;
      border-radius: 10px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border: 1px solid rgba(255,255,255,0.06);
      color: #fff;
      font-weight:700;
      cursor:pointer;
      box-shadow: 0 6px 20px rgba(0,0,0,0.25);
    }
    .custom-select__control:focus { outline: none; box-shadow: 0 10px 30px rgba(31,143,128,0.06); border-color: rgba(31,143,128,0.9); }

    .custom-select__placeholder { color: #fff; font-weight:700; }

    /* SVG arrow in the control */
    .custom-select__svg {
      width:18px;
      height:18px;
      flex: 0 0 18px;
      transition: transform 160ms ease;
      display:block;
      opacity:0.95;
    }

    /* rotate the arrow when control open */
    .custom-select__control.open .custom-select__svg { transform: rotate(180deg); }

    .custom-select__panel {
      position: absolute;
      left: 0;
      right: 0;
      top: calc(100% + 10px);
      z-index: 2200;
      background: linear-gradient(180deg, rgba(12,12,12,0.99), rgba(8,8,8,0.99));
      border-radius: 10px;
      padding: 6px;
      box-shadow: 0 24px 80px rgba(0,0,0,0.6);
      border: 1px solid rgba(255,255,255,0.03);
      max-height: 260px;
      overflow: auto;
      transform-origin: top center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 160ms ease, transform 160ms ease;
      transform: translateY(-6px);
    }
    .custom-select__panel.open { opacity: 1; visibility: visible; transform: translateY(0); }

    .custom-select__option {
      padding: .82rem 1rem;
      border-radius: 8px;
      color: #fff;
      font-weight:700;
      cursor: pointer;
      margin: 4px 2px;
    }
    .custom-select__option[aria-selected="true"] {
      background: linear-gradient(180deg, rgba(31,143,128,0.14), rgba(31,143,128,0.08));
      box-shadow: inset 0 -6px 16px rgba(0,0,0,0.18);
    }
    .custom-select__option:hover { background: rgba(255,255,255,0.03); }

    /* Small responsive tweak */
    @media (max-width:520px) {
      .custom-select { max-width: 100%; }
      .custom-select__panel { max-height: 180px; }
    }

    /* Native select fallback styling (visible briefly if JS not loaded) */
    select#term {
      background-image:
        linear-gradient(45deg, transparent 50%, #ffffff 50%),
        linear-gradient(135deg, #ffffff 50%, transparent 50%),
        linear-gradient(to right, rgba(255,255,255,0.02), rgba(255,255,255,0.02));
      background-position: calc(100% - 18px) calc(50% - 6px),
                           calc(100% - 12px) calc(50% - 6px),
                           100% 0;
      background-size: 6px 6px, 6px 6px, 1px 36px;
      background-repeat: no-repeat;
      padding-right: 2.6rem;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
    }
  </style>
</head>
<body>
  <!-- NAVBAR (unchanged) -->
  <nav class="navbar-minimal" role="navigation" aria-label="Main navigation">
    <div class="nav-center">
      <div class="nav-left-placeholder" aria-hidden="true"></div>

      <ul class="nav-links" role="menubar" aria-hidden="false">
        <li><a role="menuitem" href="index.html" class="nav-link">Home</a></li>
        <li><a role="menuitem" href="rental-application.html" class="nav-link active">Application</a></li>
        <li><a role="menuitem" href="about.html" class="nav-link">About</a></li>
      </ul>

      <button class="nav-toggle" aria-controls="mobile-menu" aria-expanded="false" aria-label="Open menu">
        <span class="hamburger" aria-hidden="true"></span>
      </button>
    </div>

    <div id="mobile-menu" class="mobile-menu-wrap hidden" aria-hidden="true">
      <nav class="mobile-menu" role="menu" aria-label="Mobile menu">
        <a role="menuitem" href="index.html">Home</a>
        <a role="menuitem" href="rental-application.html" class="active">Application</a>
        <a role="menuitem" href="about.html">About</a>
      </nav>
    </div>
  </nav>

  <main>
    <div class="container rental-container">
      <img src="Logos/logo-transparent.png" alt="Newfound Living Logo" class="logo" />

      <h1 class="centered-title">Rental Application</h1>

      <form id="rental-form" action="https://formspree.io/f/xldnwbqq" method="POST" novalidate>
        <fieldset class="form-section" aria-label="Personal information">
          <h2>Personal Information</h2>

          <label for="full-name">Full Name</label>
          <input type="text" id="full-name" name="full_name" required />

          <label for="email">Email</label>
          <input type="email" id="email" name="email_address" required />

          <label for="phone">Phone Number</label>
          <input type="tel" id="phone" name="phone_number" required />

          <label for="current-address">Current Address</label>
          <input type="text" id="current-address" name="current_address" required />

          <label for="landlord-name">Current Landlord Name</label>
          <input type="text" id="landlord-name" name="landlord_name" />

          <label for="landlord-contact">Landlord Contact (Phone or Email)</label>
          <input type="text" id="landlord-contact" name="landlord_contact" />
        </fieldset>

        <fieldset class="form-section" aria-label="Property details">
          <h2>Property Details</h2>

          <label for="property-address">Property Address</label>
          <input type="text" id="property-address" name="property_address" required placeholder="e.g., 123 Main St" />

          <label for="move-in-date">Desired Move-in Date</label>
          <input type="date" id="move-in-date" name="move_in_date" required />

          <label for="term">Lease Term</label>

          <!-- Native select kept for form submission (visually hidden by the script after enhancement) -->
          <select id="term" name="lease_term" aria-label="Lease term">
            <option value="">Select</option>
            <option value="12 months">12 months</option>
            <option value="month-to-month">Month-to-month</option>
          </select>

          <!-- Custom UI is injected below by the inline script — it includes a down-arrow SVG -->
        </fieldset>

        <fieldset class="form-section" aria-label="Employment and proof of income">
          <h2>Employment / Income</h2>
          <label for="employer-name">Employer Name</label>
          <input type="text" id="employer-name" name="employer_name" required />

          <label><strong>Proof of Income / Financial Assistance</strong></label>
          <p class="helper">
            Upload via Google Form and paste the confirmation/Drive link, or choose Email to attach documents to an outgoing message.
          </p>

          <div class="option-group" role="radiogroup" aria-label="Proof submission method" style="text-align:center;">
            <label style="display:inline-flex; gap:.5rem; align-items:center;">
              <input type="radio" name="proof_option" value="google_form" checked />
              <span>Google Form</span>
            </label>

            <label style="display:inline-flex; gap:.5rem; align-items:center; margin-left:1rem;">
              <input type="radio" name="proof_option" value="email" />
              <span>Email</span>
            </label>
          </div>

          <div id="google-flow" class="proof-flow" aria-hidden="false" style="text-align:center; margin-top:.6rem;">
            <a id="open-google-form" class="btn-primary" href="https://forms.gle/DQZHf9fBEhqGBFzs8" target="_blank" rel="noopener noreferrer" role="button" aria-label="Open Google Form to upload proof of income">Open Google Form</a>

            <div class="inline-row" style="margin-top:.8rem;">
              <input type="url" id="proof-income-link" name="proof_income_link" placeholder="Paste Google Form confirmation or Drive link here" aria-label="Paste proof link" />
            </div>

            <div style="margin-top:.6rem;">
              <button type="button" id="paste-clipboard" class="btn-primary paste-centered" title="Paste URL from clipboard">Paste link</button>
            </div>
          </div>

          <div id="email-flow" class="proof-flow" style="display:none; margin-top:.6rem;" aria-hidden="true">
            <p class="helper">Click the button to open your email client, attach proof, and include your name & property address.</p>
            <div style="text-align:center; margin-top:8px;">
              <button type="button" id="email-proof-btn" class="btn-primary--small" title="Email proof">Email Proof of Income</button>
            </div>
          </div>
        </fieldset>

        <fieldset class="form-section" aria-label="Pets">
          <h2>PETS</h2>

          <div class="pets-center-block" style="margin-top:.6rem;">
            <div class="pets-question-label" style="font-weight:600; margin-bottom:10px; text-align:center;">Do you have pets?</div>

            <div class="pet-radio-group" role="radiogroup" aria-label="Do you have pets?">
              <label class="pet-option" tabindex="0">
                <input type="radio" name="pets" value="Yes" />
                <span class="radio-square yes"><span class="icon check-icon">✓</span></span>
                <span class="pet-label-text">Yes</span>
              </label>

              <label class="pet-option" tabindex="0">
                <input type="radio" name="pets" value="No" checked />
                <span class="radio-square no"><span class="icon x-icon">✕</span></span>
                <span class="pet-label-text">No</span>
              </label>
            </div>
          </div>

          <label for="pet-type" style="margin-top:8px;">Other / Breed (if applicable)</label>
          <input type="text" id="pet-type" name="pet_type_text" placeholder="e.g., Beagle, Medium / Other details" />

          <label for="pet-number">How many pets?</label>
          <input type="number" id="pet-number" name="pet_number" min="0" />

          <label for="pet-details">Description (age, vaccinated, etc.)</label>
          <textarea id="pet-details" name="pet_details" placeholder="Describe your pets"></textarea>
        </fieldset>

        <fieldset class="form-section" aria-label="Other details">
          <h2>Other Details</h2>

          <label>Additional Occupants</label>
          <div id="occupants-list">
            <div class="occupant-fields" data-index="1" style="display:flex; gap:8px; flex-wrap:wrap; margin-top:.4rem;">
              <input type="text" name="occupant_name_1" placeholder="Name" style="flex:1 1 200px"/>
              <input type="number" name="occupant_age_1" placeholder="Age" min="0" style="width:120px"/>
              <input type="tel" name="occupant_phone_1" placeholder="Phone Number" style="flex:1 1 180px"/>
            </div>
          </div>
          <div style="margin-top:10px;">
            <button type="button" class="btn-primary" id="add-occupant" aria-label="Add occupant">+ Add Occupant</button>
          </div>

          <label style="margin-top:12px; display:block;">References</label>
          <div id="references-list">
            <div class="reference-fields" data-index="1" style="display:flex; gap:8px; flex-wrap:wrap; margin-top:.4rem;">
              <input type="text" name="reference_name_1" placeholder="Name" style="flex:1 1 200px"/>
              <input type="tel" name="reference_phone_1" placeholder="Phone Number" style="width:160px"/>
              <input type="text" name="reference_relationship_1" placeholder="Relationship" style="flex:1 1 160px"/>
            </div>
          </div>
          <div style="margin-top:10px;">
            <button type="button" class="btn-primary" id="add-reference" aria-label="Add reference">+ Add Reference</button>
          </div>

          <label for="emergency-contact" style="margin-top:12px">Emergency Contact Name</label>
          <input type="text" id="emergency-contact" name="emergency_contact" />

          <label for="emergency-phone">Emergency Contact Phone</label>
          <input type="tel" id="emergency-phone" name="emergency_phone" />

          <label for="other-info">Any other information you'd like to provide?</label>
          <textarea id="other-info" name="other_info"></textarea>
        </fieldset>

        <fieldset class="form-section" aria-label="Declaration">
          <h2>Declaration</h2>
          <p class="helper">I declare that the information provided is true and complete. I authorize Newfound Living to verify this application.</p>

          <label for="applicant-signature">Signature</label>
          <input type="text" id="applicant-signature" name="applicant_signature" required />

          <label for="applicant-signature-date">Date</label>
          <input type="date" id="applicant-signature-date" name="applicant_signature_date" required />
        </fieldset>

        <div style="text-align:center; margin:1.2rem 0;">
          <button type="submit" class="btn-primary" aria-label="Submit application">Submit Application</button>
        </div>
      </form>
    </div>
  </main>

  <a class="floating-contact" href="mailto:info.newfoundliving@gmail.com?subject=General Inquiry" aria-label="Contact Newfound Living">Contact</a>

  <!-- Page scripts -->
  <script>
  // Mobile menu
  (function () {
    const toggle = document.querySelector('.nav-toggle');
    const wrap = document.getElementById('mobile-menu');
    if (!toggle || !wrap) return;
    function open() { toggle.classList.add('open'); toggle.setAttribute('aria-expanded','true'); wrap.classList.remove('hidden'); wrap.classList.add('visible'); wrap.setAttribute('aria-hidden','false'); const f = wrap.querySelector('a'); if (f) f.focus(); }
    function close(returnFocus=true) { toggle.classList.remove('open'); toggle.setAttribute('aria-expanded','false'); wrap.classList.remove('visible'); wrap.classList.add('hidden'); wrap.setAttribute('aria-hidden','true'); if (returnFocus) toggle.focus(); }
    toggle.addEventListener('click', () => { if (wrap.classList.contains('visible')) close(); else open(); });
    toggle.addEventListener('keydown', (e) => { if (e.key==='Enter'||e.key===' ') { e.preventDefault(); toggle.click(); } if (e.key==='Escape') close(); });
    wrap.addEventListener('click', (e) => { if (e.target.closest('a')) close(false); });
    window.addEventListener('resize', () => { if (window.innerWidth > 760) close(false); });
  })();

  // Occupant / Reference dynamic adders
  (function () {
    let occupantCount = 1;
    const addOccupantBtn = document.getElementById('add-occupant');
    const occupantsList = document.getElementById('occupants-list');
    if (addOccupantBtn) {
      addOccupantBtn.addEventListener('click', () => {
        occupantCount++;
        const div = document.createElement('div');
        div.className = 'occupant-fields';
        div.dataset.index = occupantCount;
        div.style.display = 'flex';
        div.style.gap = '8px';
        div.style.flexWrap = 'wrap';
        div.style.marginTop = '.6rem';
        div.innerHTML = `
          <input type="text" name="occupant_name_${occupantCount}" placeholder="Name" style="flex:1 1 200px"/>
          <input type="number" name="occupant_age_${occupantCount}" placeholder="Age" min="0" style="width:120px"/>
          <input type="tel" name="occupant_phone_${occupantCount}" placeholder="Phone Number" style="flex:1 1 180px"/>
          <button type="button" class="btn-primary--small remove-entry" aria-label="Remove occupant" style="margin-left:6px;">Remove</button>
        `;
        occupantsList.appendChild(div);
        div.querySelector('.remove-entry').addEventListener('click', () => div.remove());
      });
    }

    let referenceCount = 1;
    const addReferenceBtn = document.getElementById('add-reference');
    const referencesList = document.getElementById('references-list');
    if (addReferenceBtn) {
      addReferenceBtn.addEventListener('click', () => {
        referenceCount++;
        const div = document.createElement('div');
        div.className = 'reference-fields';
        div.dataset.index = referenceCount;
        div.style.display = 'flex';
        div.style.gap = '8px';
        div.style.flexWrap = 'wrap';
        div.style.marginTop = '.6rem';
        div.innerHTML = `
          <input type="text" name="reference_name_${referenceCount}" placeholder="Name" style="flex:1 1 200px"/>
          <input type="tel" name="reference_phone_${referenceCount}" placeholder="Phone Number" style="width:160px"/>
          <input type="text" name="reference_relationship_${referenceCount}" placeholder="Relationship" style="flex:1 1 160px"/>
          <button type="button" class="btn-primary--small remove-entry" aria-label="Remove reference" style="margin-left:6px;">Remove</button>
        `;
        referencesList.appendChild(div);
        div.querySelector('.remove-entry').addEventListener('click', () => div.remove());
      });
    }
  })();

  // Proof of income flow + clipboard/paste + email helper
  (function () {
    const proofRadios = Array.from(document.querySelectorAll('input[name="proof_option"]'));
    const googleFlow = document.getElementById('google-flow');
    const emailFlow = document.getElementById('email-flow');
    const openGoogleBtn = document.getElementById('open-google-form');
    const pasteBtn = document.getElementById('paste-clipboard');
    const proofLinkInput = document.getElementById('proof-income-link');
    const emailProofBtn = document.getElementById('email-proof-btn');

    function showFlow() {
      const r = document.querySelector('input[name="proof_option"]:checked');
      const val = r ? r.value : 'google_form';
      if (val === 'google_form') {
        if (googleFlow) { googleFlow.style.display = ''; googleFlow.setAttribute('aria-hidden','false'); }
        if (emailFlow) { emailFlow.style.display = 'none'; emailFlow.setAttribute('aria-hidden','true'); }
      } else {
        if (googleFlow) { googleFlow.style.display = 'none'; googleFlow.setAttribute('aria-hidden','true'); }
        if (emailFlow) { emailFlow.style.display = ''; emailFlow.setAttribute('aria-hidden','false'); }
      }
    }
    proofRadios.forEach(r => r.addEventListener('change', showFlow));
    showFlow();

    if (pasteBtn) pasteBtn.addEventListener('click', async () => {
      if (!navigator.clipboard) { alert('Clipboard API not available. Please paste manually.'); return; }
      try {
        const text = await navigator.clipboard.readText();
        if (text && text.trim()) { proofLinkInput.value = text.trim(); proofLinkInput.focus(); } else { alert('No URL text found in clipboard.'); }
      } catch (err) { console.error(err); alert('Unable to read clipboard.'); }
    });

    if (emailProofBtn) emailProofBtn.addEventListener('click', () => {
      const to = 'info.newfoundliving@gmail.com';
      const fullName = (document.getElementById('full-name') || {value:''}).value;
      const property = (document.getElementById('property-address') || {value:''}).value;
      const subject = `Proof of Income for ${fullName || '[Your Name]'} - ${property || '[Property]'}`;
      const bodyLines = ['Hello Newfound Living,', '', 'I am attaching proof of income for my rental application.', '', `Name: ${fullName || ''}`, `Property: ${property || ''}`, '', 'Please confirm receipt.', '', 'Thank you.'];
      const mailto = `mailto:${encodeURIComponent(to)}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(bodyLines.join('\n'))}`;
      window.location.href = mailto;
    });
  })();

  // Pet option keyboard/click handling
  (function () {
    const petOptions = Array.from(document.querySelectorAll('.pet-option'));
    petOptions.forEach(el => {
      el.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          const input = el.querySelector('input[type="radio"]');
          if (input) { input.checked = true; input.dispatchEvent(new Event('change', { bubbles: true })); }
        }
      });
      el.addEventListener('click', (e) => {
        const input = el.querySelector('input[type="radio"]');
        if (input && e.target.tagName.toLowerCase() !== 'input') {
          input.checked = true;
          input.dispatchEvent(new Event('change', { bubbles: true }));
        }
      });
    });
  })();

  // Form submit handler: focus first invalid field
  (function () {
    const form = document.getElementById('rental-form');
    if (!form) return;
    form.addEventListener('submit', (e) => {
      if (!form.checkValidity()) {
        const firstInvalid = form.querySelector(':invalid');
        if (firstInvalid) firstInvalid.focus();
        e.preventDefault();
      }
    });
  })();
  </script>

  <!-- Inline custom select script (adds down arrow SVG and injects UI) -->
  <script>
  (function () {
    const native = document.getElementById('term');
    if (!native) return;

    // Create root/custom UI
    const root = document.createElement('div');
    root.className = 'custom-select';
    root.setAttribute('aria-hidden','false');

    // Control (button)
    const control = document.createElement('button');
    control.type = 'button';
    control.className = 'custom-select__control';
    control.setAttribute('aria-haspopup', 'listbox');
    control.setAttribute('aria-expanded', 'false');
    control.setAttribute('aria-label', native.getAttribute('aria-label') || 'Lease term');

    const labelSpan = document.createElement('span');
    labelSpan.className = 'custom-select__placeholder';
    labelSpan.textContent = native.options[native.selectedIndex]?.textContent || 'Select';

    // Down arrow SVG
    const svgNS = "http://www.w3.org/2000/svg";
    const svg = document.createElementNS(svgNS, 'svg');
    svg.setAttribute('viewBox', '0 0 24 24');
    svg.className = 'custom-select__svg';
    svg.setAttribute('aria-hidden', 'true');
    const path = document.createElementNS(svgNS, 'path');
    path.setAttribute('d', 'M7 10l5 5 5-5');
    path.setAttribute('fill', 'none');
    path.setAttribute('stroke', 'currentColor');
    path.setAttribute('stroke-width', '2');
    path.setAttribute('stroke-linecap', 'round');
    path.setAttribute('stroke-linejoin', 'round');
    svg.appendChild(path);

    control.appendChild(labelSpan);
    control.appendChild(svg);
    root.appendChild(control);

    // Panel (options)
    const panel = document.createElement('div');
    panel.className = 'custom-select__panel';
    panel.setAttribute('role', 'listbox');
    panel.setAttribute('tabindex', '-1');

    Array.from(native.options).forEach((opt, idx) => {
      const item = document.createElement('div');
      item.className = 'custom-select__option';
      item.setAttribute('role', 'option');
      item.dataset.value = opt.value;
      item.dataset.index = idx;
      item.textContent = opt.textContent;
      if (opt.disabled) {
        item.setAttribute('aria-disabled', 'true');
        item.style.opacity = '.5';
      }
      if (opt.selected) item.setAttribute('aria-selected', 'true');
      else item.setAttribute('aria-selected', 'false');
      panel.appendChild(item);
    });

    root.appendChild(panel);

    // Insert root after native select and visually hide native select (keeps it for form submit)
    native.parentNode.insertBefore(root, native.nextSibling);
    native.classList.add('select-hidden-keep');

    const options = Array.from(panel.querySelectorAll('.custom-select__option'));
    let open = false;
    let focusedIndex = native.selectedIndex >= 0 ? native.selectedIndex : 0;

    function openPanel() {
      panel.classList.add('open');
      control.classList.add('open');
      control.setAttribute('aria-expanded','true');
      open = true;
      panel.focus();
      options.forEach((o, i) => o.classList.toggle('focused', i === focusedIndex));
    }
    function closePanel() {
      panel.classList.remove('open');
      control.classList.remove('open');
      control.setAttribute('aria-expanded','false');
      open = false;
      control.focus();
    }
    function setValue(index) {
      const opt = native.options[index];
      if (!opt || opt.disabled) return;
      native.selectedIndex = index;
      labelSpan.textContent = opt.textContent;
      options.forEach((o, i) => o.setAttribute('aria-selected', i === index ? 'true' : 'false'));
      focusedIndex = index;
      native.dispatchEvent(new Event('change', { bubbles: true }));
    }

    // Control click toggles panel
    control.addEventListener('click', function (e) {
      e.preventDefault();
      if (open) closePanel(); else openPanel();
    });

    // Click outside closes
    document.addEventListener('click', function (e) {
      if (!root.contains(e.target)) closePanel();
    });

    // Option click
    panel.addEventListener('click', function (e) {
      const opt = e.target.closest('.custom-select__option');
      if (!opt || opt.getAttribute('aria-disabled') === 'true') return;
      const idx = Number(opt.dataset.index);
      setValue(idx);
      closePanel();
    });

    // Keyboard navigation on control
    control.addEventListener('keydown', function (e) {
      if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
        e.preventDefault();
        if (!open) openPanel();
        focusedIndex = (e.key === 'ArrowDown') ? Math.min(focusedIndex + 1, options.length - 1) : Math.max(focusedIndex - 1, 0);
        options.forEach((o, i) => {
          o.classList.toggle('focused', i === focusedIndex);
          if (i === focusedIndex) o.scrollIntoView({ block: 'nearest' });
        });
      } else if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        if (!open) openPanel();
        else { setValue(focusedIndex); closePanel(); }
      } else if (e.key === 'Escape') { e.preventDefault(); closePanel(); }
    });

    // Keyboard in panel
    panel.addEventListener('keydown', function (e) {
      if (e.key === 'ArrowDown') { e.preventDefault(); focusedIndex = Math.min(focusedIndex + 1, options.length - 1); }
      else if (e.key === 'ArrowUp') { e.preventDefault(); focusedIndex = Math.max(focusedIndex - 1, 0); }
      else if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); setValue(focusedIndex); closePanel(); }
      else if (e.key === 'Escape') { e.preventDefault(); closePanel(); }
      options.forEach((o, i) => {
        o.classList.toggle('focused', i === focusedIndex);
        if (i === focusedIndex) o.scrollIntoView({ block: 'nearest' });
      });
    });

    // initialize label text
    setValue(native.selectedIndex >= 0 ? native.selectedIndex : 0);
  })();
  </script>
</body>
</html>
